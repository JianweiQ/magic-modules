---
subcategory: "Cloud SQL"
description: |-
  Executes a SQL script to provision in-database resources in Google Cloud SQL.
---

# google_sql_provision_script

~> **Warning:** The SQL script and its execution response might transit through intermediate locations between your client and the location of the target instance.

Executes a SQL script to provision in-database resources on a Cloud SQL Instance. For more information, see the [Cloud SQL official documentation](https://cloud.google.com/sql/docs/mysql/executesql-instance), or the [JSON API](https://cloud.google.com/sql/docs/admin-api/v1beta4/instances/executeSql).

~> **Note:** Terraform connects to the instance via [IAM database authentication](https://cloud.google.com/sql/docs/mysql/authentication) to execute the script, so the identity account used to apply your Terraform config must exist as an IAM user or IAM service account in the instance. You also need to grant roles or privileges to this IAM user or IAM service account so it has permission to execute statements in your provision scripts. See the example below.


## Example Usage

Example managing a Cloud SQL instance with a provision script.

```hcl
resource "google_sql_database_instance" "instance" {
  name             = "my-instance"
  database_version = "POSTGRES_17"

  settings {
    tier            = "db-perf-optimized-N-2"
    data_api_access = "ALLOW_DATA_API"
    database_flags {
      name  = "cloudsql.iam_authentication"
      # For MySQL, the flag name is "cloudsql_iam_authentication"
      value = "on"
    }
  }
}

# Create a database user for your account and grant roles so it has privilege to access the database.
# Set the type to "CLOUD_IAM_USER" for huamn account or "CLOUD_IAM_SERVICE_ACCOUNT" for service account.
# If a service account is used and the instance is Postgres, please trim the ".gserviceaccount.com" suffix
# to avoid exceeding the username length limit.
resource "google_sql_user" "db_user" {
  name     = "account-used-to-apply-this-config@example.com"
  instance = google_sql_database_instance.instance.name
  type     = "CLOUD_IAM_USER" 
  database_roles = ["cloudsqlsuperuser"]  # Roles granted to the user. Smaller roles are preferred, if exist.
}

resource "google_sql_database" "database" {
  name     = "my-database"
  instance = google_sql_database_instance.instance.name
}

resource "google_sql_provision_script" "extensions" {
  script  = "CREATE TABLE IF NOT EXISTS table1 ( col VARCHAR(16) NOT NULL );"
  database = google_sql_database.database.name
  instance = google_sql_database_instance.instance.name
  depends_on = [google_sql_user.iam_user]
}

resource "google_sql_provision_script" "tables" {
  script  = "file("${path.module}/tables.sql")
  database = google_sql_database.database.name
  instance = google_sql_database_instance.instance.name
  depends_on = [google_sql_user.db_user]  # This DB user account must exist first.
}
```

## Argument Reference

The following arguments are supported:

* `name` - (Required) The name of the provision script.

* `script` - (Required) The SQL script to provision database resources. Its execution time limit
    is 30 s and it will be canceled if it takes longer than 30 s. You can use patterns like
    `create if not exists …` or `if not exists (select …) then … end if` to avoid existence-related
    errors. If it's not possible to make a statement idempotent, you can run it once and then remove
    it from this script.

* `instance` - (Required) The name of the Cloud SQL instance. Changing this forces the script to
    be run on the new instance.

* `database` - (Required) The name of the database on which the SQL script is executed. This is
    required for Postgres instances. Changing this forces the script to be run using this database.

* `deletion_policy` - (Optional) The deletion policy for the resources created by the script. The
    default is "ABANDON". It must be "ABANDON" to allow Terraform to abandon the resources. If you
    want to delete resources, add statements in the script such as `drop … if exists`.

## Attributes Reference

Only the arguments listed above are exposed as attributes.

## Timeouts

This resource provides the following
[Timeouts](https://developer.hashicorp.com/terraform/plugin/sdkv2/resources/retries-and-customizable-timeouts) configuration options: configuration options:

- `create` - Default is 20 minutes. Note the provider has its own timeout too -- the provision script execution must finish in 30 s or it will be canceled by the database. 

